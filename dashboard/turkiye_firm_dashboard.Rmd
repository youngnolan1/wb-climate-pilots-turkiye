---
title: "TÃ¼rkiye Maps"
output: 
  flexdashboard::flex_dashboard:
    orientation: columns
    vertical_layout: fill
  output_dir: docs
baseurl: "/wb-climate-pilots-turkiye"
---

```{r setup, include=FALSE}
library(flexdashboard)
library(dplyr)
library(sf)
library(leaflet)
library(ggplot2)
```


```{r, warning=FALSE}
# Run scripts which cleans data and creates plotting functions
setwd("C:/Users/young/OneDrive/Escritorio/wb-climate-pilots-turkiye")
source("scripts/2_firm_data_clean.R")

setwd("C:/Users/young/OneDrive/Escritorio/wb-climate-pilots-turkiye")
source("scripts/3_climate_data_clean.R")

setwd("C:/Users/young/OneDrive/Escritorio/wb-climate-pilots-turkiye")
source("scripts/4_edgar_data_clean.R")

setwd("C:/Users/young/OneDrive/Escritorio/wb-climate-pilots-turkiye")
source("scripts/5_naturaldisaster_data_clean.R")
```


Location
=======================================================================

Column {.tabset .tabset-fade data-width=500}
-----------------------------------------------------------------------

### Firm location

```{r}
leaflet(firms) %>%
  
  addTiles() %>% 
  
  # Change map tiles so that locations shown in English
  addProviderTiles(providers$OpenStreetMap.DE) %>% 
  
  addAwesomeMarkers(lng = ~lon_mask, lat = ~lat_mask,
                    popup = ~paste("Region: ", a2x, "<br>",
                                   "Sector: ", stra_sector, "<br>",
                                   "Size: ", size
                    ))
```

### Number of firms in each grid

```{r}
heatplot(sf_firm_count, NULL, NULL)
```

Column {.tabset .tabset-fade data-width=500}
-----------------------------------------------------------------------

### Total GHG Emissions 2022 (all sectors)

```{r}
heatplot(total22, "Total GHG Emissions 2022", "Millions of tons")
```

### Industrial Combustion & Processes GHG Emissions 2022

```{r}
heatplot(industrial_sector, "Industrial Sector GHG Emissions 2022", "Millions of tons")
```

### Hot Days

```{r}
legend_title <- "Difference in weighted avg"

heatplot_climate(sf_hotdays, "% Change in Average Yearly Number of Hot Days\nPre (2000-10) to Current (2011-21) Period", legend_title)
```

### SPEI

```{r}
heatplot_climate(sf_spei, "% Change in Average Yearly SPEI\nPre (2000-10) to Current (2011-21) Period", legend_title)
```

### Consecutive Wet Days (5mm)

```{r}
heatplot_climate(sf_cwd, "% Change in Average Yearly Maximum of\nConsecutive Wet Days - Pre (2000-10) to Current (2011-21) Period", legend_title)
```

### Precipitation

```{r}
heatplot_climate(sf_precip, "% Change in Average Yearly Precipitation\nPre (2000-10) to Current (2011-21) Period", legend_title)
```

### Dry Days

```{r}
heatplot_climate(sf_drydays, "% Change in Average Yearly Number of Dry Days\nPre (2000-10) to Current (2011-21) Period", legend_title)
```

### Consecutive Dry Days (1mm)

```{r}
heatplot_climate(sf_cdd, "% Change in Average Yearly Maximum of\nConsecutive Dry Days - Pre (2000-10) to Current (2011-21) Period", legend_title)
```

### Firms facing water availability issues

```{r}
heatplot(sf_water_availability, "Number of firms facing water availability\nissues in 2011-12", NULL)
```

### Number of disasters

```{r}
heatplot(sf_disaster_count, "Number of disasters 2000-2021", NULL)
```

### Disaster alert level

```{r}
heatplot_alert(sf_disaster_alert, "Average disaster alert level (green-1 /\norange-2 / red-3)", NULL)
```

### Disaster casualties

```{r}
heatplot(sf_disaster_casualties, "Total number of casualties 2000-2021", NULL)
```

### Displaced people

```{r}
heatplot(sf_disaster_displaced, "Total number of displaced people", "In thousands")
```


Size
=======================================================================

Column {.tabset .tabset-fade data-width=500}
-----------------------------------------------------------------------

### Average "size" (1-3 classification)

```{r}
heatplot(sf_avgsize, NULL, NULL)
```

### Average number of employees 

```{r}
heatplot(sf_avgnumemployees, NULL, NULL)
```


Column {.tabset .tabset-fade data-width=500}
-----------------------------------------------------------------------

### Total GHG Emissions 2022 (all sectors)

```{r}
heatplot(total22, "Total GHG Emissions 2022", "Millions of tons")
```

### Industrial Combustion & Processes GHG Emissions 2022

```{r}
heatplot(industrial_sector, "Industrial Sector GHG Emissions 2022", "Millions of tons")
```

### Hot Days

```{r}
legend_title <- "Difference in weighted avg"

heatplot_climate(sf_hotdays, "% Change in Average Yearly Number of Hot Days\nPre (2000-10) to Current (2011-21) Period", legend_title)
```

### SPEI

```{r}
heatplot_climate(sf_spei, "% Change in Average Yearly SPEI\nPre (2000-10) to Current (2011-21) Period", legend_title)
```

### Consecutive Wet Days (5mm)

```{r}
heatplot_climate(sf_cwd, "% Change in Average Yearly Maximum of\nConsecutive Wet Days - Pre (2000-10) to Current (2011-21) Period", legend_title)
```

### Precipitation

```{r}
heatplot_climate(sf_precip, "% Change in Average Yearly Precipitation\nPre (2000-10) to Current (2011-21) Period", legend_title)
```

### Dry Days

```{r}
heatplot_climate(sf_drydays, "% Change in Average Yearly Number of Dry Days\nPre (2000-10) to Current (2011-21) Period", legend_title)
```

### Consecutive Dry Days (1mm)

```{r}
heatplot_climate(sf_cdd, "% Change in Average Yearly Maximum of\nConsecutive Dry Days - Pre (2000-10) to Current (2011-21) Period", legend_title)
```

### Firms facing water availability issues

```{r}
heatplot(sf_water_availability, "Number of firms facing water availability\nissues in 2011-12", NULL)
```

### Number of disasters

```{r}
heatplot(sf_disaster_count, "Number of disasters 2000-2021", NULL)
```

### Disaster alert level

```{r}
heatplot_alert(sf_disaster_alert, "Average disaster alert level (green-1 /\norange-2 / red-3)", NULL)
```

### Disaster casualties

```{r}
heatplot(sf_disaster_casualties, "Total number of casualties 2000-2021", NULL)
```

### Displaced people

```{r}
heatplot(sf_disaster_displaced, "Total number of displaced people", "In thousands")
```


Sectors
=======================================================================

Column {.tabset .tabset-fade data-width=500}
-----------------------------------------------------------------------

### Manufacturing

```{r}
legend_title <- "Weighted\nproportion"

heatplot(sector_count("Manufacturing"), NULL, legend_title)

sansinstan <- sector_count("Manufacturing")
maxcity <- which.max(sansinstan[["HeatVar"]])
sansinstan[maxcity, "HeatVar"] <- NA

maxcity <- which.max(sansinstan[["HeatVar"]])
sansinstan[maxcity, "HeatVar"] <- NA

heatplot(sansinstan, NULL, legend_title)
```

### Wholesale and retail trade

```{r}
heatplot(sector_count("Wholesale and retail trade"), NULL, legend_title)
```

### Transport, storage and communications

```{r}
heatplot(sector_count("Transport, storage and communications"), NULL, legend_title)
```

### Real estate, renting and business activities

```{r}
heatplot(sector_count("Real estate, renting and business activities"), NULL, legend_title)
```

### Construction

```{r}
heatplot(sector_count("Construction"), NULL, legend_title)
```

### Hotels and restaurants

```{r}
heatplot(sector_count("Hotels and restaurants"), NULL, legend_title)
```

Column {.tabset .tabset-fade data-width=500}
-----------------------------------------------------------------------

### Total GHG Emissions 2022 (all sectors)

```{r}
heatplot(total22, "Total GHG Emissions 2022", "Millions of tons")
```

### Industrial Combustion & Processes GHG Emissions 2022

```{r}
heatplot(industrial_sector, "Industrial Sector GHG Emissions 2022", "Millions of tons")
```

### Hot Days

```{r}
legend_title <- "Difference in weighted avg"

heatplot_climate(sf_hotdays, "% Change in Average Yearly Number of Hot Days\nPre (2000-10) to Current (2011-21) Period", legend_title)
```

### SPEI

```{r}
heatplot_climate(sf_spei, "% Change in Average Yearly SPEI\nPre (2000-10) to Current (2011-21) Period", legend_title)
```

### Consecutive Wet Days (5mm)

```{r}
heatplot_climate(sf_cwd, "% Change in Average Yearly Maximum of\nConsecutive Wet Days - Pre (2000-10) to Current (2011-21) Period", legend_title)
```

### Precipitation

```{r}
heatplot_climate(sf_precip, "% Change in Average Yearly Precipitation\nPre (2000-10) to Current (2011-21) Period", legend_title)
```

### Dry Days

```{r}
heatplot_climate(sf_drydays, "% Change in Average Yearly Number of Dry Days\nPre (2000-10) to Current (2011-21) Period", legend_title)
```

### Consecutive Dry Days (1mm)

```{r}
heatplot_climate(sf_cdd, "% Change in Average Yearly Maximum of\nConsecutive Dry Days - Pre (2000-10) to Current (2011-21) Period", legend_title)
```

### Firms facing water availability issues

```{r}
heatplot(sf_water_availability, "Number of firms facing water availability\nissues in 2011-12", NULL)
```

### Number of disasters

```{r}
heatplot(sf_disaster_count, "Number of disasters 2000-2021", NULL)
```

### Disaster alert level

```{r}
heatplot_alert(sf_disaster_alert, "Average disaster alert level (green-1 /\norange-2 / red-3)", NULL)
```

### Disaster casualties

```{r}
heatplot(sf_disaster_casualties, "Total number of casualties 2000-2021", NULL)
```

### Displaced people

```{r}
heatplot(sf_disaster_displaced, "Total number of displaced people", "In thousands")
```
